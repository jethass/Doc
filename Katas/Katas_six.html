<!DOCTYPE html>
<!-- saved from url=(0042)http://university.sensiolabs.com/katas/006 -->
<html lang="en" class="csstransforms csstransforms3d csstransitions"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>Katas</title>
    <link rel="apple-touch-icon" sizes="57x57" href="http://university.sensiolabs.com/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="http://university.sensiolabs.com/apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="http://university.sensiolabs.com/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="http://university.sensiolabs.com/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="http://university.sensiolabs.com/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="http://university.sensiolabs.com/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="http://university.sensiolabs.com/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="http://university.sensiolabs.com/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="http://university.sensiolabs.com/apple-touch-icon-180x180.png">
    <link rel="icon" type="image/png" href="http://university.sensiolabs.com/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="http://university.sensiolabs.com/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="http://university.sensiolabs.com/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="http://university.sensiolabs.com/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="http://university.sensiolabs.com/manifest.json">
    <link rel="mask-icon" href="http://university.sensiolabs.com/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="apple-mobile-web-app-title" content="SensioLabs University">
    <meta name="application-name" content="SensioLabs University">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <link rel="stylesheet" href="./Katas_six_files/font-awesome.min.css">
    <link rel="stylesheet" href="./Katas_six_files/prettyPhoto.css">
    <link rel="stylesheet" href="./Katas_six_files/animate.css">
    <link rel="stylesheet" href="./Katas_six_files/main.css">
    <link rel="stylesheet" href="./Katas_six_files/semantic.min.css">
    <link rel="stylesheet" href="./Katas_six_files/font-awesome.min(1).css">
    <link rel="stylesheet" href="./Katas_six_files/prism.css">
    <link rel="stylesheet" href="./Katas_six_files/prism-show-language.css">
    <script async="true" type="text/javascript" src="./Katas_six_files/event" data-owner="criteo-tag"></script><script async="" src="./Katas_six_files/analytics.js.téléchargement"></script><script type="text/javascript" async="" src="./Katas_six_files/ld.js.téléchargement"></script><script type="text/javascript" async="" src="./Katas_six_files/dc.js.téléchargement"></script><script type="text/javascript" async="" defer="" src="./Katas_six_files/piwik.js.téléchargement"></script><script src="./Katas_six_files/d3.v4.js.téléchargement"></script>
    <script src="./Katas_six_files/d3-scale-chromatic.v0.3.js.téléchargement"></script>

    <style>
blockquote {
    margin: 0 0 0 20px;
}
blockquote p {
    font-size: inherit;
}

.kata-story ul {
    list-style: none;
    padding: 0;
}
.kata-story li {
    padding-left: 1.3em;
}
.kata-story li:before {
    content: "\f046"; /* FontAwesome Unicode */
    font-family: FontAwesome;
    display: inline-block;
    margin-left: -1.3em; /* same as padding-left set on li */
    width: 1.3em; /* same as padding-left set on li */
}
.kata-steps li:not(:first-child):not(:last-child) {
    margin: 30px 0;
}
.kata-steps li li {
    margin: 0!important;
}

.kata-solution h4:not(:first-child) {
    margin-top: 40px;
}
</style>

    <link rel="stylesheet" href="./Katas_six_files/slu-custom.css">

    
    <link rel="stylesheet" href="./Katas_six_files/sln.css" type="text/css" media="all">
    <!--[if lt IE 9]>
    <script src="/bundles/app/new/js/html5shiv.js"></script>
    <script src="/bundles/app/new/js/respond.min.js"></script>
    <![endif]-->
                <!-- Piwik -->
    <script type="text/javascript">
      var _paq = _paq || [];
      // tracker methods like "setCustomDimension" should be called before "trackPageView"
      _paq.push(['trackPageView']);
      _paq.push(['enableLinkTracking']);
      _paq.push(['enableHeartBeatTimer']);
            _paq.push(['setUserId', '05342fd3-47df-4d96-925f-e37bdca5169a']);
            (function() {
        var u="//university.sensiolabs.com/piwik/";
        _paq.push(['setTrackerUrl', u+'piwik.php']);
        _paq.push(['setSiteId', '1']);
        var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
        g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
      })();
    </script>
    <!-- End Piwik Code -->
    </head>
<body style="padding-top: 96px;">
<div id="sln" style="height: 36px;"><div class="sln-bar"><div class="sln-bar-inner"><div class="sln-network"><a href="http://university.sensiolabs.com/katas/006#" class="sln-hidden-phone">SensioLabs<span>World</span></a><a href="http://university.sensiolabs.com/katas/006#" class="sln-visible-phone">SL<span>W</span></a></div> <div class="sln-ad"><a href="https://blackfire.io/" data-ga="blackfire" class="sln-visible-phone"><img src="./Katas_six_files/1c5498dd-0649-4d42-af4b-1de957825f62.png">Blackfire.io</a><a href="https://blackfire.io/" data-ga="blackfire" class="sln-visible-tablet"><img src="./Katas_six_files/1c5498dd-0649-4d42-af4b-1de957825f62.png">Blackfire.io: Fire up your PHP apps performance</a><a href="https://blackfire.io/" data-ga="blackfire" class="sln-visible-desktop"><img src="./Katas_six_files/1c5498dd-0649-4d42-af4b-1de957825f62.png">Blackfire.io: Fire up your PHP apps performance</a></div>  <div class="sln-user"> <a class="sln-user-connected" href="http://university.sensiolabs.com/katas/006#"><img src="./Katas_six_files/05342fd3-47df-4d96-925f-e37bdca5169a.png" width="30" height="30" alt="Lataoui Hassine"><span class="sln-user-name sln-hidden-phone">Lataoui Hassine</span></a> </div>
    </div>
    <div class="sln-dropdown-network sln-dropdown sln-hidden"><div class="sln-container"><div class="sln-row"><div class="sln-span6"><div class="sln-row"><div class="sln-span3"><img src="./Katas_six_files/sensiolabs.png" alt="SensioLabs"><p>Since 1998, SensioLabs has been promoting the Open-Source software movement by providing quality and performant web application development products, trainings,  and consulting. SensioLabs also supports multiple important Open-Source projects. <br><a data-ga="sln_learn_more" href="http://sensiolabs.com/en">Learn more</a></p><div><a data-ga="sln_sl_international" href="http://sensiolabs.com/en">International</a></div><ul class="sln-websites"><li>Local:</li><li class="first"><a data-ga="sln_sl_FR" href="http://sensiolabs.com/fr">France</a></li><li><a data-ga="sln_sl_DE" href="http://sensiolabs.de/">Deutschland</a></li><li><a data-ga="sln_sl_UK" href="http://sensiolabs.co.uk/">UK</a></li></ul></div><div class="sln-span3 sln-ads"><h2>In the Spotlight</h2><div><a data-ga="sln_insight_thumb" href="https://insight.sensiolabs.com/"><img src="./Katas_six_files/sensiolabsinsight.png" alt="SensioLabsInsight"></a></div><div><a data-ga="sln_blackfire_thumb" href="https://blackfire.io/"><img src="./Katas_six_files/blackfire.png" alt="Blackfire"></a></div></div></div></div><div class="sln-span6 sln-products-listing sln-right-box"><div class="sln-row"><div class="sln-span3"><h2>Open Source</h2><ul><li><a data-ga="sln_sf" href="http://symfony.com/">Symfony - Web framework</a></li><li><a data-ga="sln_twig" href="http://twig.sensiolabs.org/">Twig - Templating</a></li><li><a data-ga="sln_silex" href="http://silex.sensiolabs.org/">Silex - Micro-framework</a></li><li><a data-ga="sln_swift" href="http://www.swiftmailer.org/">Swift Mailer - E-Mailing</a></li></ul></div><div class="sln-span3"><h2>Products</h2><ul><li><a data-ga="sln_insight" href="https://insight.sensiolabs.com/">Insight: PHP Quality</a></li><li><a data-ga="sln_profiler" href="https://blackfire.io/">Blackfire: Web App performance</a></li><li><a data-ga="sln_security_checker" href="https://security.sensiolabs.org/">Security checker</a></li></ul></div></div><div class="sln-row"><div class="sln-span3"><h2>Solutions &amp; Services</h2><ul><li><a data-ga="sln_training" href="https://training.sensiolabs.com/">Training</a></li><li><a data-ga="sln_certification" href="https://sensiolabs.com/certification">Certification</a></li><li><a data-ga="sln_services" href="https://sensiolabs.com/solutions">Technical Solutions</a></li><li><a data-ga="sln_support" href="https://sensiolabs.com/support">Support</a></li><li><a data-ga="sln_experts" href="http://expert.sensiolabs.com/">Experts</a></li></ul></div><div class="sln-span3"><h2>Community</h2><ul><li><a data-ga="sln_connect" href="https://connect.sensiolabs.com/">Community</a></li><li><a data-ga="sln_live" href="http://live.symfony.com/">Conferences</a></li><li><a data-ga="sln_youtube" href="https://www.youtube.com/user/SensioLabs">Videos</a></li><li><a data-ga="sln_partners" href="https://sensiolabs.com/en/partnership/overview.html">Partners</a></li><li><a data-ga="sln_job_board" href="http://jobs.sensiolabs.com/">Job Board</a></li></ul></div></div></div><div class="sln-right-box sln-our-blogs"><div class="sln-row "><div class="sln-span5"><h2>Our Blogs</h2>&nbsp;&nbsp;&nbsp;
                        <a href="http://symfony.com/blog/">Symfony</a>,
                        <a href="http://blog.sensiolabs.com/">SensioLabs</a>,
                        <a href="http://blog.insight.sensiolabs.com/">Insight</a>,
                        and <a href="http://blog.blackfire.io/">Blackfire</a>.
                    </div></div></div></div></div></div>
    <div class="sln-dropdown-user sln-dropdown sln-hidden"><div class="sln-container"><div class="sln-row"><div class="sln-user-actions sln-span3"><h2>Your actions</h2><ul> <li><a href="https://connect.sensiolabs.com/">Edit your profile</a></li><li class="sln-separator"></li><li><a href="http://university.sensiolabs.com/logout">Logout</a></li> </ul></div><div class="sln-span9 sln-notifications-container"><h2>Good job, you don't have any unread notification</h2><a href="https://connect.sensiolabs.com/notifications">View all your notifications.</a></div></div></div></div>
</div></div>
<header>
    



<div class="ui fixed secondary menu">
    <div class="ui container">
                <a href="http://university.sensiolabs.com/" class="header item">
            <img class="logo" src="./Katas_six_files/sensiolabs-university.png" style="height: 40px;width: auto;">
                    </a>
                <div class="right menu">
                            <a href="http://university.sensiolabs.com/test" class="item">Test</a>


                            <a href="http://university.sensiolabs.com/me" class="item">Dashboard</a>


                            <div class="ui simple dropdown item" tabindex="0">
  Learn <i class="dropdown icon"></i>
  <div class="menu" style="margin-top: 0;border: 0;border-radius: 0 0 3px 3px" tabindex="-1">
                <a href="http://university.sensiolabs.com/katas" class="item">Katas</a>

            </div>
</div>


                                </div>
    </div>
</div>

</header>
<section id="title" class="emerald">
    <div class="ui container">
        <div>
            <h1>Kata Six — Symfony: Form - DataTransformer</h1>
        </div>
        <div>
                    </div>
    </div>
</section>

<section id="portfolio" style="min-height:700px;background: #f5f5f5 url(/images/sl-university-guy.png) no-repeat;background-size: 150px;background-position: bottom 10px right;">

<div class="ui main container">

<div class="ui stackable two column very relaxed grid">
    <div class="ten wide column">
        <div class="column-element">
            <h2>Story</h2>
            <div class="ui segment">
                <h4>As a user, I need to link Tags to my Article.</h4>
<ul>
<li>Add a way to add Tags in the form Article.</li>
<li>Link a Tag to an Article if he already exists.</li>
<li>Tags are represented as text with space between other Tags.</li>
<li>Tests dataTransformer.</li>
</ul>
            </div>
        </div>
    </div>
    <div class="six wide column">
        <div class="column-element">
            <h2>Subject</h2>
            <div class="ui segment">
                <h4>Symfony</h4>
<p><span class="ui label">Form</span> <span class="ui label">DataTransformer</span></p>
            </div>
        </div>
    </div>
    <div class="sixteen wide column">
        <div class="column-element">
            <h2>Steps</h2>
            <div class="ui segment kata-steps">
                <ol>
<li>
<p>Create an entity <code>Article</code> with those properties :</p>
<ul>
<li>title (string)</li>
<li>author (string)</li>
<li>content (text)</li>
<li>createdAt (datetime)</li>
</ul>
</li>
<li>
<p>Create another entity Tag with a title. Which has a ManyToMany relationship with the Article entity.</p>
</li>
<li>
<p>Create a <code>TagRepository</code> class with the method <code>persistAndFlush</code>, doing basically a persist then a flush of an object "Tag".</p>
</li>
<li>
<p>Make it as a service: create a <code>doctrine.xml</code> file in <code>/Resources/config</code> and declare your repository as a service with <code>factory-service="doctrine.orm.entity_manager"</code> &amp;&amp; <code>factory-method="getRepository"</code>.</p>
</li>
<li>
<p>Load your <code>doctrine.xml</code> in the Extension file of your bundle (<code>/src/YourBundle/DependencyInjection</code>).</p>
</li>
<li>
<p>Create a ModelTransformer class (<code>TagModelTransformer</code>) which implements the <code>DataTransformerInterface</code> in <code>Form\DataTransformer\</code>.</p>
</li>
<li>
<p>Pass to its constructor the <code>TagRepository</code></p>
</li>
<li>
<p>Implements the <code>transform</code> and <code>reverseTransform</code> methods for converting an arrayCollection to a simple array and conversely.</p>
</li>
<li>
<p>In <code>reverseTransform</code> method if a tag doesn't exist, persist a new one with ObjectManager. If not, link to Article.</p>
</li>
<li>
<p>Declare the <code>TagModelTransformer</code> as a private service (<code>public="false"</code>).</p>
</li>
<li>
<p>Create a ViewTransformer class (<code>TagViewTransformer</code>) which implements the <code>DataTransformerInterface</code> in <code>Form\DataTransformer\</code>.</p>
</li>
<li>
<p>Implements <code>transform</code> and <code>reverseTransform</code> method for converting an array to a string with space and conversely : You can use <code>explode</code> and <code>implode</code> PHP functions.</p>
</li>
<li>
<p>Declare it as a private service.</p>
</li>
<li>
<p>Now time to create a Type for the tag called <code>TagType</code> which implements the method <code>getName()</code> (mandatory, returning a string), and the method <code>buildForm</code> (taking as arguments a FormBuilderInterface &amp;&amp; an array of options).</p>
</li>
<li>
<p>Add the <code>TagModelTransformer</code> &amp;&amp; <code>TagViewTransformer</code> to the builder.</p>
</li>
<li>
<p>You'll make it a service: you'll need your two DataTransformers, so create 2 private properties that will be initiated in the constructor.</p>
</li>
<li>
<p>Declare it as service: create a <code>form.xml</code> file in <code>/Resources/config</code> and declare your type with the tag <code>form.type</code> (make sure that the alias is the same as the string returned by the <code>getName()</code> method in your type), the two dependancies =&gt; your ModelTransformer and ViewTransformer <code>$builder-&gt;addViewTransformer($viewTransformer)-&gt;addModelTransformer($modelTransformer);</code></p>
</li>
<li>
<p>Then create a Type for your Article called <code>ArticleType</code> with your new TagType (indicate the alias of your type like
<code>-&gt;add('tags', 'tags_selector')</code>).</p>
</li>
<li>
<p>Declare it as a service in the <code>form.xml</code> file.</p>
</li>
<li>
<p>Then create your Controller with actions to show, create, edit, delete articles.</p>
</li>
<li>
<p>Create views accordingly to your actions.</p>
</li>
<li>
<p>Time for tests! Create a directory /Tests/Unit/Form/DataTransformer</p>
</li>
<li>
<p>To test the <code>TagModelTransformerTest</code>:</p>
<ul>
<li>first create a <code>TagModelTransformerTest</code> extending <code>\PHPUnit_Framework_TestCase</code>;</li>
<li>implement the <code>setUp()</code> method to initiate the two private properties <code>$repo</code> (a mock of the <code>TagRepository</code>) and <code>$transformer</code>(a real instance of <code>TagModelTransformer</code> taking the repository as argument)</li>
<li>create your unit tests to test the <code>transform()</code> and <code>reverseTransform()</code> methods of your ModelTransformer =&gt; basically verify that the method converts an arrayCollection to a simple array and conversely.</li>
<li>Make sure that your tests cover the case of having an existing tag title and a new tag title!</li>
</ul>
</li>
<li>To test the <code>TagViewTransformerTest</code>:
<ul>
<li>first create a <code>TagViewTransformerTest</code> extending <code>\PHPUnit_Framework_TestCase</code>;</li>
<li>create your unit tests to test the <code>transform()</code> and <code>reverseTransform()</code> methods of your ViewTransformer =&gt; basically verify that the method converts an array to a string with space and conversely.</li>
</ul></li>
</ol>
            </div>
        </div>
    </div>
    <div class="sixteen wide column">
        <div class="column-element">
            <h2>Help</h2>
            <div class="ui segment">
                <ul>
<li><a href="http://symfony.com/doc/current/cookbook/form/data_transformers.html">http://symfony.com/doc/current/cookbook/form/data_transformers.html</a></li>
<li><a href="https://speakerdeck.com/webmozart/3-steps-to-symfony2-form-mastery">https://speakerdeck.com/webmozart/3-steps-to-symfony2-form-mastery</a></li>
<li><a href="https://speakerdeck.com/hhamon/ingenierie-inversee-du-composant-form-de-symfony">https://speakerdeck.com/hhamon/ingenierie-inversee-du-composant-form-de-symfony</a></li>
</ul>
            </div>
        </div>
    </div>
    </div>
</div>
</section>

<footer style="background: #1B1C1D;color:#FFF;padding: 4px;height: 30px;">
    <div style="text-align:center">
                <i class="fa fa-code" aria-hidden="true"></i> with <i class="fa fa-heart-o" aria-hidden="true"></i> by <a target="_blank" href="http://sensiolabs.com/" title="SensioLabs"><img src="./Katas_six_files/sensiolabs-logo.png" alt="SensioLabs" width="90" style="width:90px;vertical-align: -2px;"></a>
                , deployed on <a href="https://sensio.cloud/"><img target="_blank" title="SensioCloud" src="./Katas_six_files/sensiocloud-logo.svg" width="90" style="width:90px;vertical-align: -2px;"></a>
    </div>
</footer>

<script src="./Katas_six_files/jquery.js.téléchargement"></script>
<script src="./Katas_six_files/bootstrap.min.js.téléchargement"></script>
<script src="./Katas_six_files/semantic.min.js.téléchargement"></script>
<script src="./Katas_six_files/jquery.prettyPhoto.js.téléchargement"></script>
<script src="./Katas_six_files/jquery.isotope.min.js.téléchargement"></script>
<script src="./Katas_six_files/main.js.téléchargement"></script>

<script type="text/javascript" src="./Katas_six_files/sln.js.téléchargement"></script>
<script type="text/javascript">
$(function() {
              SLNBar.isAuthenticated = true;
       SLNBar.uuid = '05342fd3-47df-4d96-925f-e37bdca5169a';
       SLNBar.fullName = 'Lataoui Hassine';
       SLNBar.actions = {
           '0': { 'url': SLNBar.urlConnectHomepage, 'label': "Edit your profile" }
       };
       SLNBar.separatedActions = {
           '0': { 'url': '/logout', 'label' : "Logout" }
       };
              $('#sln').html(SLNBar.render());
       SLNBar.bindEvents();
   });
</script>
<script src="./Katas_six_files/prism.js.téléchargement"></script>
<script src="./Katas_six_files/prism-show-language.min.js.téléchargement"></script>
<script src="./Katas_six_files/prism-php.min.js.téléchargement"></script>
<script src="./Katas_six_files/prism-php-extras.min.js.téléchargement"></script>
<script src="./Katas_six_files/prism-twig.min.js.téléchargement"></script>
<script src="./Katas_six_files/prism-yaml.min.js.téléchargement"></script>
<script src="./Katas_six_files/prism-json.min.js.téléchargement"></script>

<script>
$(function () {
    $('.ui .progress').progress({
        duration : 200,
        showActivity: false
    });

    $('.ui.dropdown').dropdown();

    $('.ui.accordion').accordion();

    $('.ui.notinteractive.rating').rating({
        interactive: false
    });
    $('.ui.vote.rating').rating('setting', 'onRate', function(value) {
        document.getElementById($(this).data('field')).value = value;
    });
})
</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-79731882-1', 'university.sensiolabs.com');
  ga('send', 'pageview');
    ga('set', 'userId', '05342fd3-47df-4d96-925f-e37bdca5169a');
  </script>


<div id="criteo-tags-div" style="display: none;"><iframe height="0" width="0" src="./Katas_six_files/dis.html" style="display: none;"></iframe></div></body></html>